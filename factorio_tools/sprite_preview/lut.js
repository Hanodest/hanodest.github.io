let lutImage = "data:image/png;base64," +
  "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" +
  "lUR5AAAAAElFTkSuQmCC";

async function getNightLut() {
  let image = new Image()
  image.src = lutImage;

  return new Promise((resolve) => {
    image.addEventListener('load', () => {
      let canvas = new OffscreenCanvas(image.width, image.height);
      let context = canvas.getContext('2d');
      context.drawImage(image, 0, 0);
      let data = context.getImageData(0, 0, image.width, image.height).data;
      let result = [];
      for (let r = 0; r < 16; r++) {
        result[r] = [];
        for (let g = 0; g < 16; g++) {
          result[r][g] = [];
          for (let b = 0; b < 16; b++) {
            let idx = (g * 256 + b * 16 + r) * 4;
            result[r][g][b] = data.slice(idx, idx + 4);
          }
        }
      }
      resolve(result);
    });
  });
}

let lookupTable = await getNightLut();

function lookupColor(color) {
  let r = Math.floor(color[0] / 17)
  let g = Math.floor(color[1] / 17)
  let b = Math.floor(color[2] / 17)
  return lookupTable[r][g][b];
};

export { lookupColor };
